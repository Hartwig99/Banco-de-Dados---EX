13 – Escreva uma consulta que mostre, por fornecedor, o percentual de variação no valor
comprado em 2016, em relação a 2015.

SELECT 	X.FORNECEDOR,
		SUM(X.TOTAL_COMPRA_2016)	AS TOTAL_COMPRA_2016,
		SUM(X.TOTAL_COMPRA_2015)	AS TOTAL_COMPRA_2015,
		CASE WHEN (SUM(X.TOTAL_COMPRA_2015) = 0) 
				     THEN (100)
				 ELSE ((SUM(X.TOTAL_COMPRA_2016) - SUM(X.TOTAL_COMPRA_2015)) / SUM(X.TOTAL_COMPRA_2015)) * 100
				 END					AS VARIACAO
FROM		(
				SELECT 	FORN.NOME_FANTASIA		 		AS FORNECEDOR,
						SUM(MOV.QUANTIDADE * PRO.PRECO)	AS TOTAL_COMPRA_2016,
						0								AS TOTAL_COMPRA_2015
                        FROM FORNECEDOR FORN
                                   INNER JOIN COMPRA CMP    ON FORN.IDFORNECEDOR = CMP.IDFORNECEDOR
                                   INNER JOIN MOVIMENTO MOV ON CAST(SUBSTRING(MOV.IDORIGEM FROM 4) AS INTEGER) = CMP.IDCOMPRA
                                   INNER JOIN PRODUTO PRO	 ON PRO.IDPRODUTO = MOV.IDPRODUTO
                        WHERE 	MOV.DATA_MOVIMENTO BETWEEN '01/01/2016' AND '31/12/2016'
                        GROUP BY	FORN.NOME_FANTASIA
				
UNION ALL
				
				SELECT 	FORN.NOME_FANTASIA		 		AS FORNECEDOR,
						0								AS TOTAL_COMPRA_2016,
						SUM(MOV.QUANTIDADE * PRO.PRECO)	AS TOTAL_COMPRA_2015
				FROM	FORNECEDOR FORN
							INNER JOIN COMPRA CMP    ON FORN.IDFORNECEDOR = CMP.IDFORNECEDOR
							INNER JOIN MOVIMENTO MOV ON CAST(SUBSTRING(MOV.IDORIGEM FROM 4) AS INTEGER) = CMP.IDCOMPRA
							INNER JOIN PRODUTO PRO	 ON PRO.IDPRODUTO = MOV.IDPRODUTO
                        WHERE 		MOV.DATA_MOVIMENTO BETWEEN '01/01/2015' AND '31/12/2015'
				GROUP BY	FORN.NOME_FANTASIA
			) X
GROUP BY 	X.FORNECEDOR
ORDER BY 	X.FORNECEDOR
