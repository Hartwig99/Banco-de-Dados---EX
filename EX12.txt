12 â€“ Escreva uma consulta que liste, por loja, o saldo de estoque em 2017.

SELECT		LJ.DESCRICAO			AS LOJA,
			M.SALDO					AS SALDO
FROM 		LOJA LJ
			CROSS JOIN (SELECT SUM(CASE WHEN (MOV.TIPO_MOVIMENTO = 'S') THEN (MOV.QUANTIDADE * (-1)) 
							   ELSE (MOV.QUANTIDADE) END) AS SALDO
						FROM   MOVIMENTO MOV
						WHERE  MOV.DATA_MOVIMENTO BETWEEN '01/01/2017' AND '31/12/2017') M
ORDER BY	LJ.DESCRICAO

OR

SELECT		LJ.DESCRICAO					AS LOJA,
			SUM(CASE WHEN (MOV.TIPO_MOVIMENTO = 'S') 
				THEN (MOV.QUANTIDADE * (-1)) 
				ELSE (MOV.QUANTIDADE) END)	AS SALDO
FROM 		LOJA LJ
			INNER JOIN VENDA VDA 	 ON VDA.IDLOJA = LJ.IDLOJA
			INNER JOIN COMPRA CMP	 ON CMP.IDLOJA = LJ.IDLOJA
			INNER JOIN MOVIMENTO MOV ON CAST(SUBSTRING(MOV.IDORIGEM FROM 4) AS INTEGER) = VDA.IDVENDA
WHERE  		MOV.DATA_MOVIMENTO BETWEEN '01/01/2017' AND '31/12/2017'
GROUP BY	LJ.DESCRICAO
ORDER BY	LJ.DESCRICAO
